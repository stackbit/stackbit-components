#!/usr/bin/env node

const path = require('path');
const fse = require('fs-extra');
const componentsManifest = require('../src/components-manifest.json');

console.log('generating .storybook/storybook-dynamic.js ...');
const joined = Object.entries(componentsManifest)
    .filter(([_, component]) => component.isDynamic)
    .map(([componentName, component]) => {
        return `${component.modelName}: ${component.path.split('/')[0]}.${componentName}`;
    })
    .join(',\n    ');

const result = `// ⚠️ This file is autogenerated by 'scripts/generate-storybook-dynamic.js'
// To update this file, change 'src/components-manifest.json' and re-run 'npm run build'

import { components, layouts } from '../src';

const dynamicComponents = {
    ${joined}
};

export default dynamicComponents;
`;
fse.copy(path.join(__dirname, '../models'), path.join(__dirname, '../public/models'));
fse.writeFileSync(path.join(__dirname, '../.storybook/storybook-dynamic.js'), result, 'utf8');
console.log('generated .storybook/storybook-dynamic.js');
